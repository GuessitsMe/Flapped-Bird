<!DOCTYPE html>
<html>
<head> 
<style>
  body { margin: 0; overflow: hidden; font-family: 'Courier New', Courier, monospace; display: flex; justify-content: center; align-items: center; height: 100vh; background: #1a1a1a; }
  #game { position: relative; width: 320px; height: 480px; border: 4px solid #fff; overflow: hidden; transition: background 3s ease; background: #70c5ce; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
  .building { position: absolute; bottom: 40px; background: #4ca4ab; z-index: 1; display: grid; padding: 4px; gap: 3px; border: 1px solid rgba(0,0,0,0.2); transition: background 3s; }
  .window { background: rgba(255,255,255,0.2); width: 100%; height: 100%; border-radius: 1px; }
  #ground { position: absolute; bottom: 0; width: 640px; height: 40px; background: #ded895; border-top: 4px solid #543847; z-index: 5; }
  #bird { position: absolute; left: 50px; top: 230px; width: 22px; height: 20px; background: #fdf000; border: 2px solid #000; border-radius: 50%; z-index: 10; transform-origin: center; }
  #bird::after { content: ''; position: absolute; top: 8px; right: -6px; width: 8px; height: 6px; background: #f00; border-radius: 2px; border: 1px solid #000; }
  .pipe { position: absolute; width: 50px; background: linear-gradient(to right, #73bf2e, #a0d86b, #559021); border: 2px solid #000; z-index: 4; }
  .pipe-cap { position: absolute; width: 60px; height: 22px; background: linear-gradient(to right, #73bf2e, #a0d86b, #559021); border: 2px solid #000; left: -7px; }
  #score { position: absolute; top: 10px; width: 100%; text-align: center; font-size: 40px; color: white; text-shadow: 3px 3px #000; z-index: 20; }
  #menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 30; color: white; }
  .stat-box { background: #ded895; border: 3px solid #543847; padding: 15px; color: #543847; border-radius: 8px; width: 220px; text-align: center; }
  #leaderboard-list { list-style: none; padding: 0; font-size: 14px; margin-top: 10px; }
  input { padding: 8px; width: 140px; border-radius: 4px; border: none; margin-top: 10px; }
  button { background: #2ecc71; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-top: 5px; font-weight: bold; }
</style>
</head>
<body>

<div id="game">
  <div id="score">0</div>
  <div id="bird"><div id="wing"></div></div>
  <div id="ground"></div>
  
  <div id="menu">
    <h1>FLAPPY CITY</h1>
    <div class="stat-box">
      <div>SCORE: <span id="final-score">0</span></div>
      <div id="save-section" style="display:none;">
        <input type="text" id="player-name" placeholder="Enter Name" maxlength="10">
        <button onclick="saveScore()">SAVE SCORE</button>
      </div>
      <hr>
      <strong>TOP SCORES (ONLINE)</strong>
      <ul id="leaderboard-list">Loading...</ul>
    </div>
    <button onclick="startGame()" style="font-size: 20px; padding: 15px 30px; margin-top: 20px;">START GAME</button>
  </div>
</div>

<script>
  // --- CONFIGURATION: REPLACE WITH YOUR SIMPLEBOARDS DATA ---
  const API_KEY = 'YOUR_API_KEY'; 
  const BOARD_ID = 'YOUR_BOARD_ID';
  const API_BASE = 'api.simpleboards.dev';

  // Game variables
  const bird = document.getElementById('bird');
  const scoreEl = document.getElementById('score');
  let birdY = 230, velocity = 0, gravity = 0.25, score = 0;
  let pipes = [], gameRunning = false;

  function startGame() {
    document.getElementById('menu').style.display = 'none';
    resetGame();
    gameRunning = true;
    requestAnimationFrame(update);
    setInterval(createPipe, 1500);
  }

  function resetGame() {
    birdY = 230; velocity = 0; score = 0; pipes.forEach(p => p.remove()); pipes = [];
    scoreEl.innerText = '0';
  }

  function createPipe() {
    if (!gameRunning) return;
    const gap = 120;
    const pipeTop = document.createElement('div');
    pipeTop.className = 'pipe';
    const height = Math.random() * 200 + 50;
    pipeTop.style.height = height + 'px';
    pipeTop.style.top = '0';
    pipeTop.style.left = '320px';
    pipeTop.innerHTML = '<div class="pipe-cap" style="bottom:-2px"></div>';
    
    const pipeBottom = document.createElement('div');
    pipeBottom.className = 'pipe';
    pipeBottom.style.height = (480 - height - gap - 40) + 'px';
    pipeBottom.style.bottom = '40px';
    pipeBottom.style.left = '320px';
    pipeBottom.innerHTML = '<div class="pipe-cap" style="top:-2px"></div>';

    document.getElementById('game').appendChild(pipeTop);
    document.getElementById('game').appendChild(pipeBottom);
    pipes.push(pipeTop, pipeBottom);
  }

  function update() {
    if (!gameRunning) return;
    velocity += gravity;
    birdY += velocity;
    bird.style.top = birdY + 'px';
    bird.style.transform = `rotate(${Math.min(velocity * 4, 90)}deg)`;

    if (birdY < 0 || birdY > 420) return gameOver();

    pipes.forEach((p, i) => {
      let x = parseInt(p.style.left) - 2;
      p.style.left = x + 'px';
      
      // Collision (Simplified)
      const bRect = bird.getBoundingClientRect();
      const pRect = p.getBoundingClientRect();
      if (bRect.right > pRect.left && bRect.left < pRect.right && bRect.top < pRect.bottom && bRect.bottom > pRect.top) {
        gameOver();
      }

      if (x < -60) { p.remove(); pipes.splice(i, 1); score += 0.5; scoreEl.innerText = Math.floor(score); }
    });
    requestAnimationFrame(update);
  }

  function gameOver() {
    gameRunning = false;
    document.getElementById('menu').style.display = 'flex';
    document.getElementById('final-score').innerText = Math.floor(score);
    document.getElementById('save-section').style.display = 'block';
    fetchLeaderboard();
  }

  window.onmousedown = () => { if(gameRunning) velocity = -5; };

  // --- ONLINE LEADERBOARD LOGIC ---
  async function saveScore() {
    const name = document.getElementById('player-name').value || 'Anon';
    try {
      await fetch(`${API_BASE}/board/${BOARD_ID}/entry`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'x-api-key': API_KEY },
        body: JSON.stringify({ name: name, score: Math.floor(score) })
      });
      document.getElementById('save-section').style.display = 'none';
      fetchLeaderboard();
    } catch (e) { console.error("Save failed", e); }
  }

  async function fetchLeaderboard() {
    try {
      const res = await fetch(`${API_BASE}/board/${BOARD_ID}/entries?limit=5`, {
        headers: { 'x-api-key': API_KEY }
      });
      const data = await res.json();
      const list = document.getElementById('leaderboard-list');
      list.innerHTML = data.entries.map((e, i) => `<li>${i+1}. ${e.name}: ${e.score}</li>`).join('') || "No scores yet!";
    } catch (e) { document.getElementById('leaderboard-list').innerText = "Error loading scores."; }
  }

  // Load leaderboard on startup
  fetchLeaderboard();
</script>
</body>
</html>
